<table class="sourcetable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="source" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">process_revision_directives</span>(context, revision, directives):
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">getattr</span>(config<span style="color: #666666">.</span>cmd_opts, <span style="color: #BA2121">&#39;autogenerate&#39;</span>, <span style="color: #008000">False</span>):
            script <span style="color: #666666">=</span> directives[<span style="color: #666666">0</span>]
            <span style="color: #008000; font-weight: bold">if</span> script<span style="color: #666666">.</span>upgrade_ops<span style="color: #666666">.</span>is_empty():
                directives[:] <span style="color: #666666">=</span> []
                logger<span style="color: #666666">.</span>info(<span style="color: #BA2121">&#39;No changes in schema detected.&#39;</span>)

    engine <span style="color: #666666">=</span> engine_from_config(config<span style="color: #666666">.</span>get_section(config<span style="color: #666666">.</span>config_ini_section),
                                prefix<span style="color: #666666">=</span><span style="color: #BA2121">&#39;sqlalchemy.&#39;</span>,
                                poolclass<span style="color: #666666">=</span>pool<span style="color: #666666">.</span>NullPool)

    connection <span style="color: #666666">=</span> engine<span style="color: #666666">.</span>connect()
    context<span style="color: #666666">.</span>configure(connection<span style="color: #666666">=</span>connection,
                      target_metadata<span style="color: #666666">=</span>target_metadata,
                      process_revision_directives<span style="color: #666666">=</span>process_revision_directives,
                      <span style="color: #666666">**</span>current_app<span style="color: #666666">.</span>extensions[<span style="color: #BA2121">&#39;migrate&#39;</span>]<span style="color: #666666">.</span>configure_args)

    <span style="color: #008000; font-weight: bold">try</span>:
        <span style="color: #008000; font-weight: bold">with</span> context<span style="color: #666666">.</span>begin_transaction():
            context<span style="color: #666666">.</span>run_migrations()
    <span style="color: #008000; font-weight: bold">finally</span>:
        connection<span style="color: #666666">.</span>close()

<span style="color: #008000; font-weight: bold">if</span> context<span style="color: #666666">.</span>is_offline_mode():
    run_migrations_offline()
<span style="color: #008000; font-weight: bold">else</span>:
</pre></div>
</td></tr></table>